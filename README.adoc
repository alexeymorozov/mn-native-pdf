= Metanorma Native PDF

image:https://github.com/metanorma/mn-native-pdf/workflows/ubuntu/badge.svg["Build Status", link="https://github.com/metanorma/mn-native-pdf/actions?workflow=ubuntu"]
image:https://github.com/metanorma/mn-native-pdf/workflows/macos/badge.svg["Build Status", link="https://github.com/metanorma/mn-native-pdf/actions?workflow=macos"]

The experimental PDFs are available here:

* https://metanorma.github.io/mn-native-pdf/[Metanorma mn2pdf samples]


== Purpose

This repository pilots native PDF capabilities of Metanorma using XML-FO via Apache FOP.


== Installing Build Tools

You will need `mn2pdf`, `envsubst`, `make` and a number of fonts.


=== On macOS

[source,sh]
----
# Install `envsubst`
brew install gettext
brew link --force gettext

# Install cabextract
brew install cabextract

# Install Fontforge
brew install fontforge

# Install p7zip
brew install p7zip
----

[source,sh]
----
# Install Microsoft Vista fonts
export MN_PDF_FONT_PATH=$(pwd)/fonts
mkdir -p ${MN_PDF_FONT_PATH}/truetype/vista/

curl -Ls https://gist.githubusercontent.com/ronaldtse/b53c05030a1eee94087aa9f80592b88b/raw/macos-vista-fonts-installer.sh | sudo bash

ls -alR ~/Library/Fonts/Microsoft

ln -s ~/Library/Fonts/Microsoft/Calibri\ Bold\ Italic.ttf ${MN_PDF_FONT_PATH}/truetype/vista/calibriz.ttf
ln -s ~/Library/Fonts/Microsoft/Calibri\ Bold.ttf         ${MN_PDF_FONT_PATH}/truetype/vista/calibrib.ttf
ln -s ~/Library/Fonts/Microsoft/Calibri\ Italic.ttf       ${MN_PDF_FONT_PATH}/truetype/vista/calibrii.ttf
ln -s ~/Library/Fonts/Microsoft/Calibri.ttf               ${MN_PDF_FONT_PATH}/truetype/vista/calibri.ttf
ln -s ~/Library/Fonts/Microsoft/Cambria\ Bold\ Italic.ttf ${MN_PDF_FONT_PATH}/truetype/vista/cambriaz.ttf
ln -s ~/Library/Fonts/Microsoft/Cambria\ Bold.ttf         ${MN_PDF_FONT_PATH}/truetype/vista/cambriab.ttf
ln -s ~/Library/Fonts/Microsoft/Cambria\ Italic.ttf       ${MN_PDF_FONT_PATH}/truetype/vista/cambriai.ttf
ln -s ~/Library/Fonts/Microsoft/Cambria\ Math.ttf         ${MN_PDF_FONT_PATH}/truetype/vista/cambriam.ttf
ln -s ~/Library/Fonts/Microsoft/Cambria.ttf               ${MN_PDF_FONT_PATH}/truetype/vista/cambria.ttf
ln -s ~/Library/Fonts/Microsoft/Candara\ Bold\ Italic.ttf ${MN_PDF_FONT_PATH}/truetype/vista/candaraz.ttf
ln -s ~/Library/Fonts/Microsoft/Candara\ Bold.ttf         ${MN_PDF_FONT_PATH}/truetype/vista/candarab.ttf
ln -s ~/Library/Fonts/Microsoft/Candara\ Italic.ttf       ${MN_PDF_FONT_PATH}/truetype/vista/candarai.ttf
ln -s ~/Library/Fonts/Microsoft/Candara.ttf               ${MN_PDF_FONT_PATH}/truetype/vista/candara.ttf
ln -s ~/Library/Fonts/Microsoft/Consola\ Bold\ Italic.ttf ${MN_PDF_FONT_PATH}/truetype/vista/consolaz.ttf
ln -s ~/Library/Fonts/Microsoft/Consola\ Bold.ttf         ${MN_PDF_FONT_PATH}/truetype/vista/consolab.ttf
ln -s ~/Library/Fonts/Microsoft/Consola\ Italic.ttf       ${MN_PDF_FONT_PATH}/truetype/vista/consolai.ttf
ln -s ~/Library/Fonts/Microsoft/Consola.ttf               ${MN_PDF_FONT_PATH}/truetype/vista/consola.ttf
ln -s ~/Library/Fonts/Microsoft/Constan\ Bold\ Italic.ttf ${MN_PDF_FONT_PATH}/truetype/vista/constanz.ttf
ln -s ~/Library/Fonts/Microsoft/Constan\ Bold.ttf         ${MN_PDF_FONT_PATH}/truetype/vista/constanb.ttf
ln -s ~/Library/Fonts/Microsoft/Constan\ Italic.ttf       ${MN_PDF_FONT_PATH}/truetype/vista/constani.ttf
ln -s ~/Library/Fonts/Microsoft/Constan.ttf               ${MN_PDF_FONT_PATH}/truetype/vista/constan.ttf
ln -s ~/Library/Fonts/Microsoft/Corbel\ Bold\ Italic.ttf  ${MN_PDF_FONT_PATH}/truetype/vista/corbelz.ttf
ln -s ~/Library/Fonts/Microsoft/Corbel\ Bold.ttf          ${MN_PDF_FONT_PATH}/truetype/vista/corbelb.ttf
ln -s ~/Library/Fonts/Microsoft/Corbel\ Italic.ttf        ${MN_PDF_FONT_PATH}/truetype/vista/corbeli.ttf
ln -s ~/Library/Fonts/Microsoft/Corbel.ttf                ${MN_PDF_FONT_PATH}/truetype/vista/corbel.ttf
ln -s ~/Library/Fonts/Microsoft/Meiryo\ Bold\ Italic.ttf  ${MN_PDF_FONT_PATH}/truetype/vista/meiryoz.ttf
ln -s ~/Library/Fonts/Microsoft/Meiryo\ Bold.ttf          ${MN_PDF_FONT_PATH}/truetype/vista/meiryob.ttf
ln -s ~/Library/Fonts/Microsoft/Meiryo\ Italic.ttf        ${MN_PDF_FONT_PATH}/truetype/vista/meiryoi.ttf
ln -s ~/Library/Fonts/Microsoft/Meiryo.ttf                ${MN_PDF_FONT_PATH}/truetype/vista/meiryo.ttf


# Install FreeSerif
mkdir -p ${MN_PDF_FONT_PATH}/truetype/freefont/

pushd $(mktemp -d)
curl -Ls https://www.fontspace.com/download/13277/e8f09161b1174b2abe9bd65fb8223c48/gnu-freefont_freeserif.zip -o freefont.zip
unzip freefont.zip
mv *.ttf ${MN_PDF_FONT_PATH}/truetype/freefont/
popd

# Install Nanum Gothic
mkdir -p ${MN_PDF_FONT_PATH}/truetype/nanum/

pushd $(mktemp -d)
curl -Ls https://fonts.google.com/download?family=Nanum%20Gothic -o nanum.zip
unzip nanum.zip
mv NanumGothic{-,}Bold.ttf
mv NanumGothic{-,}ExtraBold.ttf
mv NanumGothic-Regular.ttf NanumGothic.ttf
mv *.ttf ${MN_PDF_FONT_PATH}/truetype/nanum/
popd

# Install Droid Sans Fallback
mkdir -p ${MN_PDF_FONT_PATH}/truetype/droid/

pushd ${MN_PDF_FONT_PATH}/truetype/droid/
wget https://github.com/aosp-mirror/platform_frameworks_base/raw/master/data/fonts/DroidSansFallbackFull.ttf
popd

# Install CJK fonts
export MN_PDF_FONT_PATH=${GITHUB_WORKSPACE}/fonts

pushd $(mktemp -d)
curl -Ls https://github.com/Pal3love/Source-Han-TrueType/raw/master/SourceHanSans.7z -o hansans.7z
7za x hansans.7z
mv *.ttc ${MN_PDF_FONT_PATH}/
popd

# Install Microsoft Core fonts
mkdir -p ${MN_PDF_FONT_PATH}/truetype/msttcorefonts
ls -alR /System/Library/Fonts
ln -s /System/Library/Fonts/Supplemental/Arial.ttf ${MN_PDF_FONT_PATH}/truetype/msttcorefonts/arial.ttf
ln -s /System/Library/Fonts/Supplemental/Arial\ Bold.ttf ${MN_PDF_FONT_PATH}/truetype/msttcorefonts/arialbd.ttf
ln -s /System/Library/Fonts/Supplemental/Arial\ Italic.ttf ${MN_PDF_FONT_PATH}/truetype/msttcorefonts/ariali.ttf
ln -s /System/Library/Fonts/Supplemental/Arial\ Bold\ Italic.ttf ${MN_PDF_FONT_PATH}/truetype/msttcorefonts/arialbi.ttf
ln -s /System/Library/Fonts/Supplemental/Times\ New\ Roman.ttf ${MN_PDF_FONT_PATH}/truetype/msttcorefonts/times.ttf
ln -s /System/Library/Fonts/Supplemental/Times\ New\ Roman\ Bold.ttf ${MN_PDF_FONT_PATH}/truetype/msttcorefonts/timesbd.ttf
ln -s /System/Library/Fonts/Supplemental/Times\ New\ Roman\ Italic.ttf ${MN_PDF_FONT_PATH}/truetype/msttcorefonts/timesi.ttf
ln -s /System/Library/Fonts/Supplemental/Times\ New\ Roman\ Bold\ Italic.ttf ${MN_PDF_FONT_PATH}/truetype/msttcorefonts/timesbi.ttf
ln -s /System/Library/Fonts/Supplemental/Courier\ New.ttf ${MN_PDF_FONT_PATH}/truetype/msttcorefonts/cour.ttf
ln -s /System/Library/Fonts/Supplemental/Courier\ New\ Italic.ttf ${MN_PDF_FONT_PATH}/truetype/msttcorefonts/couri.ttf
ln -s /System/Library/Fonts/Supplemental/Courier\ New\ Bold.ttf ${MN_PDF_FONT_PATH}/truetype/msttcorefonts/courbd.ttf
ln -s /System/Library/Fonts/Supplemental/Courier\ New\ Bold\ Italic.ttf ${MN_PDF_FONT_PATH}/truetype/msttcorefonts/courbi.ttf

ls -alR ${MN_PDF_FONT_PATH}

----

Building the document is then easy:

[source,sh]
----
export MN_PDF_FONT_PATH=$(pwd)/fonts
make all

# PDFs will be generated as documents/*.pdf
----

=== On Ubuntu Linux

[source,sh]
----
sudo apt-get -y install gettext-base cabextract wget

# Install fontforge
sudo apt-get -y install software-properties-common
sudo add-apt-repository ppa:fontforge/fontforge
sudo apt-get update
sudo apt-get -y install fontforge

# Install fonts
sudo apt-get -y install fonts-freefont-ttf fonts-nanum fonts-droid-fallback

# Install MS system fonts
echo ttf-mscorefonts-installer msttcorefonts/accepted-mscorefonts-eula select true | sudo debconf-set-selections
sudo apt-get install ttf-mscorefonts-installer

# Setup Cambria fonts
curl -Ls https://gist.github.com/maxwelleite/10774746/raw/ttf-vista-fonts-installer.sh | sudo bash
sudo chown -R $(whoami) /usr/share/fonts/
mkdir -p ~/.fonts
cp -a /usr/share/fonts/* ~/.fonts
----

NOTE: While the Cambria fonts can be setup using the very super convenient setup script kindly provided by http://plasmasturm.org[Aristotle Pagaltzis] at http://plasmasturm.org/code/vistafonts-installer/ , we have switched to https://gist.github.com/maxwelleite/10774746/raw/ttf-vista-fonts-installer.sh in order to be able to extract "Cambria Math" from `cambria.ttc` with `fontforge` for math equations.


Building the document is then easy:

[source,sh]
----
export MN_PDF_FONT_PATH=~/.fonts

# Pull submodules
make update-init update-modules

# PDFs will be generated as documents/*.pdf
make all
----


== Copyright

Ribose Inc.
